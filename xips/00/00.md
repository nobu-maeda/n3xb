# N3X Generic Exchange Protocol
N3X is the generic contract layer, primarily with a single abstract sub-object representing an offer of any trade, obligations and arbitration schemes. An `offer` is a `kind` of `content` inside a Nostr `event`.

Clients can choose to implement and understand whatever offer type it supports. Clients do not need to understand every type of offers or support all trade mechanisms. Its possible to have a trade client that only discovers particular kinds of on-chain trades, but not Lightning trades. Or clients that do not deal with trades that has any settlement with Bitcoin at all, and only uses Bitcoin as fidelity bonds to protect the non-Bitcoin settled trade.

### Kind
| kind | description           |
| ---- | --------------------- |
| 50   | N3X Offer             |
| 51   | N3X Offer Invalidate  |

### N3X Generic Offer Object
```
{
  ...
  "content": {
    "offer_type": <integer>
    "trade_mechanics": <integer>
    "trade_mechanics_details" <arbitrary JSON?>
    "maker_obligation_type": <integer>
    "maker_obligation_details": <arbitrary JSON specifying obligation maker has to fulfill contract>
    "taker_obligation_type": <integer>
    "taker_obligation_details": <arbitrary JSON specifying obligation taker has to fulfill contract>
    "dispute_resolution_type": <integer>
    "dispute_resolution_details": <arbitrary JSON?>
    "pow_algo": <string code for hash algo to use for PoW>
    "pow_difficulty": <minimum number of zeros required to pass PoW spam filter, in integer>
  }
  ...
}
```

### N3X Offer Invalidate Object
Since Nostr event persists in a relay indefinitely, invalidate events are needed to mark that an offer have been either accepted or discarded. This also gives reassurnce to the taker that they are the one that have gotten the offer locked and can continue with the trade.
```
{
  ...
  "content": {
    "offer_id": <32-bytes lowercase id of the event that contains the offer to invalidate>
    "contract_id": <32-bytes lowercase even id of the contract that resulted from this offer. Can be nil>
  }
  ...
}
```

### N3X Encrypted Messaging
N3X Encrypted Messaging is a standardization of communications between participants of an exchange, including the maker, taker, arbitrators, etc. Nostr event `kind` value of 4 will remain to be used to make it difficult to distinguish N3X messages from regular DMs. N3X messages will be distinguished via a marked header in the beginning of the Nostr event `content` where trade participant's client software would understand to be a N3X encrypted message.

Often times manual user actions, or a wake-up of a mobile client, is required to make sure the trade continues. Mobile push notification will be very valuable in these cases. As it is Nostr does not have any support for generating mobile push notifications. A NIP proposal have been made for mobile push [here](https://github.com/nostr-protocol/nips/issues/257). This is not required to make N3XB possible, but it would be a huge improvement to the overall experience and usability if the capability is available.

### N3X Encrypted Message Object
```
{
  ...
  "content": {
    "header": <32-bit unique constant value to identify this to be N3X encrypted message>
    "offer_id": <32-bytes lowercase id of the event that contains the offer this message corresponds to>
    "num_attachments": <number of attachments this message contains>
    "attachments": <list of attachments, which each is a JSON object>
  }
  ...
}
```

### N3X Generic Message Attachment Object
```
{
  "attachment_type": <integer>
  "payload": <depends on the attachment type - can be JSON, can be a binary (eg, Bitcoin Tx), can be a string (eg. LN Invoice)>
}
```

## Query
- Only `kind` filter is supported with existing Nostr implementation.
- An NIP to filter out invalidated offers will expedite the query significantly
